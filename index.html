<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>first partytown</title>
  <!-- <script src="node_modules/.bin/~partytown/debug/partytown.js"></script> -->
  <script src="~partytown/debug/partytown.js"></script>
  <script>
    partytown = {
      resolveUrl(url, location) {
        if (
          url.hostname.includes('google-analytics') ||
          url.hostname.includes('www.googletagmanager.com')
        ) {
          const proxyUrl = new URL('https://cdn.builder.io/api/v1/proxy-api');
          proxyUrl.searchParams.append('url', url);
          return proxyUrl;
        }
        
        return url;
      },
      forward: ['dataLayer.push'],
      logCalls: true,
      logGetters: true,
      logSetters: true,
      logImageRequests: true,
      logMainAccess: true,
      logSendBeaconRequests: true,
      logStackTraces: false,
      logScriptExecution: true,
    };
  </script>
   <!-- Google Tag Manager -->
   <script>
    (async function (window, document, i) {
      window['dataLayer'] = window[dataLayer] || [];

      window['dataLayer'].push({ 'gtm.start': new Date().getTime(), 'event': 'gtm.js' });

      var firstScript = document.getElementsByTagName('script')[0];
      var gtmScript = document.createElement('script');
      var dataLayer = 'dataLayer' != 'dataLayer' ? '&l=' + 'dataLayer' : '';

      gtmScript.async = true;

      // ORIGINAL
      gtmScript.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dataLayer;

      // HACK
      // gtmScript.src = './gtm.js?id=' + i + dataLayer;

      firstScript.parentNode.insertBefore(gtmScript, firstScript);
    })(window, document, 'GTM-K6ZFNWR');
  </script>
  <!-- End Google Tag Manager -->
</head>
<body>
  <h1>Google Tag Manager (GTM) ðŸŽ‰</h1>

  <p>
    <strong>dataLayer.push</strong>
    <span id="testDataLayer"></span>
  </p>

  <script>
    function gtmPush() {
      const data = { event: 'button-click', from: 'partytown' };
      console.log(`GTM dataLayer.push(${JSON.stringify(data)})`);
      dataLayer.push({ event: 'button-click', from: 'partytown' });

      const testDataLayer = document.getElementById('testDataLayer');
      testDataLayer.textContent = 'push';
    }
  </script>
  <button id="buttonDataLayerPush" onclick="gtmPush()">Partytown dataLayer.push()</button>

  <script type="text/partytown">
    (function () {
      document.body.classList.add('completed');
    })();
  </script>
</body>
</html>